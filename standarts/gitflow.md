# S&P Git Flow
> Рекомендованная схема ведения git репозитория


## 1. Словарь терминов

Деплой — процесс доставки и установки данной версии реализованного функционала
на площадку.

Боевой площадка — площадка, предназначенная для  использования функционала.

Тестовый площадка - площадка, предназначенная для тестирования реализованного
функционала.

Feature(Улучшение) — некоторая доработка, связанная с созданием нового 
функционала.

Fix(Исправление) - некоторая доработка, связанная с устранением неисправности 
существующего функционала.

## 2. Основные ветви

`develop` — основная ветвь, используемая для разработки, подготовка к следующему
релизу;

`feature/.*` — ветви дополнительного функционала;

`release/<year><month><day>` — ветвь релиза;

`master` — ветвь закрытых релизов.

## 3. Общие правила

1. Содержимое ветви `master` всегда работоспособно (deployable).
2. Ветвь `develop` деплоится только на тестовый сервер, `master` — только на 
боевой.
3. Нельзя перезаписывать(`git push -f`) содержание веток `develop` и `master`.
4. Любые измнения делаются через создание новой ветви `feature/.*`.

  Правила именования: `<issue_id>_<name>`, где `issue_id` - номер задачи в системе
  управления проектом, `name` - краткое описание изменений.

5. Ветви `feature/.*` закрываются (вливаются в `develop`) только после 
подтверждения возможности деплоя (менеджером) данного функционала при следующем 
релизе.
6. Если над проектом работает больше одного человека необходимо назначить 
Git-мастера. Git-мастером должен стать лид по проекту.
7. Деплой на продуктив производится из ветки `release/<year><month><day>` 
или `master`. Ветвь релиза имеет приоритет над `master`.
8. Git-мастеру можно всё.

## 4. Правила именования коммитов

1. Рекомендованная длина строки в коммите составляет 72 символа.  

2. Язык заголовка — английский. 
Язык детального описания — английский или русский.

3. Текст коммита должен соответствовать одному из следующих шаблонов

**Краткий коммит**
```
%Тип действия% %место изменения%: %краткое описание% [#%номер issue%]
```

**Детальный коммит**
```
%Тип действия% %место изменения%: %краткое описание% [#%номер задачи%]

[#%номер задачи%]
%Детальное описание коммита%
```

`%Тип действия%` - описывает тип вашего изменения.

Допустимые ключевые слова для описания типа действия:

  - Add
  - Change
  - Refactor
  - Merge
  - Remove
  - Fix

`%место изменения%` - определяет *основное* место/модуль/объект, в котором были 
произведены изменения. В случае измнения нескольких объектов, необходимо 
  выбрать основной или выбрать выбрать более общий уровень детализации.

`%краткое описание%` - краткое описание внесённых изменений.

`%номер задачи%` - *Необязательный параметр*. Номер задачи в PMS. Рекомендуется
указывать его в первом коммите по задаче.

## 5. User Stories

Для упрощения работы нужно использовать утилиту [Git
Flow](http://danielkummer.github.io/git-flow-cheatsheet/index.ru_RU.html). 

### 5.1. Создание нового проекта

  `$PROJECT_PATH` - папка для нового проекта

  ```bash
  cd $PROJECT_PATH
  git init
  # создание вашего первого коммита
  git checkout -b develop
  git config gitflow.prefix.versiontag 'r/'
  git flow init -d
  ```

### 5.2. Клонирование существующего проекта

  `$GIT_REPOSITORY` - адрес репозитария. Например: `git@git.snpdev.ru:saltpepper/snp-git-flow.git`  
  `$PROJECT_PATH` - папка для нового проекта

  ```bash
  git clone $GIT_REPOSITORY
  cd $PROJECT_PATH
  git config gitflow.prefix.versiontag 'r/'
  git flow init -d
  ```

### 5.3. Вы приступаете к работе на проекте первый раз за день

  2. Обновляем `develop` ветку локального репозитория.

  ```bash
  git checkout develop
  git pull --rebase
  ```

### 5.4. Необходимо разработать дополнительный функционал к проекту

  2. Создаем `feature/.*` ветку с названием `feature/$FEATURE_BRANCH`.

  `$FEATURE_BRANCH` - краткое описание изменений. Например: 
  9568_add_borsch_contest

  ```bash
  git flow feature start $FEATURE_BRANCH
  ```

  2. Выполняем задачу создавая коммиты в текущую ветку

  ```bash
  ...
  git add ...
  git commit ...
  ...
  ```
  **Важно!**
  Перед каждым коммитом проверяйте работоспособность приложения, а также
  просматривайте свои изменения на предмет опечаток, лишних пробелов, неверных
  отступов.

  3. Как можно чаще синхронизируемся с веткой `origin/develop`

  **ВАЖНО**
  Не выполняйте данный пункт, если над веткой работает более одного человека 
  или от вашей ветки созданы другие ветки
  
  ```bash
  git fetch origin
  git rebase origin/master
  git push -f origin master
  ```

  Подробнее о rebase 
  [здесь](http://git-scm.com/book/ru/v1/%D0%92%D0%B5%D1%82%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B2-Git-%D0%9F%D0%B5%D1%80%D0%B5%D0%BC%D0%B5%D1%89%D0%B5%D0%BD%D0%B8%D0%B5).
### 5.5. Необходимо **срочно** разработать дополнительный функционал к проекту

  1. Сохраняем все во временное хранилище

  ```bash
  git add --all && git stash
  ```

  2. Смотреть пункт 4.4

  3. Возвращаем изменения из временного хранилища

  ```bash
  git stash pop
  ```

### 5.6. Дополнительный функционал готов к деплою

  1. Проверяем наличие конфликтов с `develop` веткой. Если конфликты не найдены,
  переходим к следующему шагу. 
  Иначе, разрешаем конфликт, проверяем работоспособность приложения, делаем 
  коммиты и переходим к следующему шагу

  2. После того, как все необходимые изменения были зафиксированы в коммитах и
  протестированны, ветка `feature/.*` готова слиянию в `develop`.

  `$FEATURE_BRANCH` - краткое описание изменений. Например: 9568_add_borsch_contest

  ```bash
  git checkout develop
  git pull
  git checkout feature/$FEATURE_BRANCH
  git pull
  git flow feature finish
  ```

### 5.7. Дополнительный функционал готов к деплою на боевой сервер

  1. Создаем релизную ветку `release/<year><month><day>`;
  
  2. Проверяем работоспособность внесенных изменений на боевом сервере;
  
  3. Вносим правки в релизной ветве; повторяем пункты 2 и 3 до момента, пока все
  недоработки не будут исправлены;
  
  4. Сливаем релизную ветку с `master` и `develop` и удаляем.
```bash
  git flow release start $RELEASE_NAME # $RELEASE_NAME = <year><month><day>
  git push -u origin release/$RELEASE_NAME  # публикация релиза на origin 
  # внесение правок в релиз, если нужно
  git flow release finish $RELEASE_NAME
```
 
