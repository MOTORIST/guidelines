# Salt & Pepper Git flow

Рекомендованные схемы ведения git репозитория

## 1. Основные ветки
`develop`(**protected**) - основная ветвь с разработкой; подготовка к следующему релизу

`feature/.*` - ветви дополнительного функционала

`release/<year><month><day>` - релизная ветвь

`master`(**protected**) - ветвь законченных релизов

## 2. Общие правила

1. Содержимое ветви `master` всегда работоспособно (deployable).
2. Любые измнения делаются через создание новой ветви `feature/.*`.  
Правило именования: <issue_id>_<name>  
`issue_id` - номер задачи в PMS  
`name` - краткое описание изменений
3. Ветви `feature/.*` вливаются в `develop` только после подтверждения
возможности деплоя(менеджером) данного функционала при следующем релизе
4. Git-мастеру можно всё
5. Деплой в продуктив происходит из ветки `release/<year><month><day>` или `master`.
`release/<year><month><day>` имеет приоритет над `master`

## 3. Правила именования коммитов

**Краткий коммит**
```
%Тип действия% %место изменения%: %краткое описание% [#%номер issue%]
```

**Детальный коммит**
```
%Тип действия% %место изменения%: %краткое описание% [#%номер issue%]

[#%номер issue%]
%Детальное описание коммита%
```

1. `%Тип действия%` - описывает тип вашего изменения
  - Fix
  - Add
  - Change
  - Docs
  - Typo
  - Merge
  - Remove
  - Refactor
  - Tmp

  `%номер issue%` - Номер issue в PMS. *Необязательный параметр.*

  `%место изменения%` - определяет *основное* место/модуль/объект, в котором были произведены изменения.
  В случае измнения нескольких объектов, необходимо выбрать или основной, или

  `%краткое описание%` - краткое описание ваших изменений

2. Рекомендованная длина заголовка 72 символа.  
Рекомендованная длина строки детальное описание коммита 72 символа

3. Язык заголовка - английский  
Язык детального описания английски или русский

## 4. User Stories

### 4.1. Создание нового проекта

  `$PROJECT_PATH` - папка для нового проекта

  ```bash
  cd $PROJECT_PATH
  git init
  git branch master
  git config gitflow.branch.master 'master'
  git config gitflow.branch.develop 'develop'
  git config gitflow.prefix.versiontag 'r/'
  git flow init -d
  ```

### 4.2. Клонирование существующего проекта

  `$GIT_REPOSITORY` - адрес репозитария. Например: `git@git.snpdev.ru:saltpepper/snp-git-flow.git`  
  `$PROJECT_PATH` - папка для нового проекта

  ```bash
  cd $PROJECT_PATH
  git clone $GIT_REPOSITORY ./
  git config gitflow.branch.master 'master'
  git config gitflow.branch.develop 'develop'
  git config gitflow.prefix.versiontag 'r/'
  git flow init -d
  ```

### 4.3. Вы приступаете к работе на проекте первый раз за день

  2. Обновляем `develop` ветку локального репозитория.

  ```bash
  git checkout develop
  git pull --rebase
  ```

### 4.4. Необходимо разработать дополнительный функционал к проекту

  2. Создаем `feature/.*` ветку с названием `feature/$FEATURE_BRANCH`.

  `$FEATURE_BRANCH` - краткое описание изменений. Например: 9568_add_borsch_contest

  **Режим git-flow**:

  ```bash
  git flow feature start $FEATURE_BRANCH
  ```

  **Ручной режим**:

  ```bash
  git checkout develop
  git pull --rebase
  git checkout -b feature/$FEATURE_BRANCH
  ```

  2. Выполняем задачу создавая коммиты в текущую ветку

  ```bash
  ...
  git add ...
  git commit ...
  ...
  ```
  **Важно!**
  Перед каждым коммитом проверяйте работоспособность приложения, а также
  просматривайте свои изменения на предмет опечаток, лишних пробелов, неверных
  отступов.

  3. Как можно чаще синхронизируемся с веткой `origin/develop`

  **ВАЖНО**
  Не выполняйте данный пункт, если над веткой работает более одного человека или от вашей ветки созданы другие ветки
  
  ```bash
  git fetch origin
  git rebase origin/master
  git push -f origin master
  ```

### 4.5. Необходимо **срочно** разработать дополнительный функционал к проекту

  1. Сохраняем все во временное хранилище

  ```bash
  git add --all && git stash
  ```

  2. Смотреть пункт 4.4

  3. Возвращаем изменения из временного хранилища

  ```bash
  git stash pop
  ```

### 4.6. Дополнительный функционал готов к деплою

  2. Проверяем наличие конфликтов с `develop` веткой  
  Если конфликты не найдены, переходим к следующему шагу  
  Иначе, разрешаем конфликт, проверяем работоспособность приложения, делаем коммиты и переходим к следующему шагу

  2. После того, как все необходимые изменения были зафиксированы в коммитах и
  протестированны, ветка `feature/.*` готова слиянию в `develop`.

  `$FEATURE_BRANCH` - краткое описание изменений. Например: 9568_add_borsch_contest

  **Режим git-flow**:

  ```bash
  git checkout feature/$FEATURE_BRANCH
  git flow feature finish
  ```

  **Ручной режим**:

  ```bash
  git checkout $FEATUTRE_BRANCH
  git pull
  git checkout develop
  git pull
  git merge --no-ff $FEATUTRE_BRANCH
  ```
